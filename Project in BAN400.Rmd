---
title: "Project in BAN400"
author: "Nina, Stan and Imran (Group 99 )"
date: "29 10 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#add docstring
#use map functions if possible

# Uploading packages that we are going to use (add more if necessary)
library(readxl)           #reading an excel file
library(tidyverse)        #for ggplot2, magrittr pipes, dplyr, etc
```

```{r Getting the users input}
library(quantmod)

# tests: data quality for currencies, proper format for dates, if newest data is not from today, inform the user that data is eg. from yesterday (report)

#get user input
currency1 <- readline(prompt = cat("What is the first currency?"))
currency2 <- readline(prompt = cat("What is the second currency?"))
startdate <- readline(prompt = cat("What is the start date?"))
finishdate <- readline(prompt = cat("What is the finish date date?"))

currency <- gsub(" ", "", paste(currency1,"/",currency2, sep = ""), fixed = TRUE)

startdate <- "2017-09-01"
finishdate <- "today"
if (finishdate == "today"){
  finishdate <- Sys.Date()
}

#use pricer package instead of quantmod?
#https://stackoverflow.com/questions/26694042/how-to-get-currency-exchange-rates-in-r
output <- getFX(currency,
     from = startdate, to = finishdate,
     env = .GlobalEnv,
     verbose = FALSE,
     warning = TRUE,
     auto.assign = TRUE)

```

```{r Make a graph and GIF}

# import the priceR package
library(priceR)

# make the output
output <- historical_exchange_rates("EUR", to = "NOK",
                          start_date = "2018-01-01", end_date = "2020-11-21")

# libraries needed to create GIF
library(ggplot2)
library(tidyverse)
library(gganimate)
library(gifski)

# making the plot
plot <- output %>% 
  mutate(date = as.Date(date)) %>% 
  ggplot(aes(x = date, y = one_EUR_equivalent_to_x_NOK, group = 1)) +
  geom_line() +
  geom_smooth(method = 'loess')+
  ylab("Price of one EUR in NOK")+
  xlab("Date")+
  labs(title = "Exchange rates between EUR and NOK")+
  theme_classic()+
  transition_reveal(date)


# producing the GIF
mygif <- animate(plot, width=1600, height=800, renderer=gifski_renderer(loop=FALSE))  

# saving the GIF
anim_save(filename="animation.gif", mygif)


```

```{r string output - return current exchange rate}
# nothing to do here - doing it in the shiny chunk
#numerical output for today
```

```{r report - inform the user on data quality }
#if the data is current or if the data is not current
#how volatile is the data?
#ask Big Hawk what we're supposed to test???
```

```{r shiny application }
#include input and output boxes and report on data quality
library(shiny) # shiny package required to build the app

#user interface part of the app - the website that the user uses

ui <- fluidPage(
  
  #input functions
textInput(inputId = "currency1", 
          label = "What is the first currency?",
          value = "",
          width = "70px",
          placeholder = "EUR"
          ),

textInput(inputId = "currency2", 
          label = "What is the second currency?",
          value = "",
          width = "70px",
          placeholder = "NOK"
          ),

dateRangeInput(inputId = "dates",
               label = "What time period do you want to look at?",
               start = "2000-01-01",
               end = NULL,
               min = "2000-01-01",
               max = Sys.Date(),
               format = "dd-mm-yyyy",
               startview = "decade",
               weekstart = "1"
               ),
  
  #output functions
textOutput(outputId = "text_rate"),

textOutput(outputId = "text_report"),

plotOutput(outputId = "plot")

  )

#server instructions part of the app
server <- function(input, output) {
  
  #the code that generates each output goes inside the render() function
  #render functions create outputs
  
  output$text_rate <- renderText("your exchange rate is sth")
  
  output$text_report <- renderText(print("the user report is whatever"))
  
  #all the code to make a plot goes between the braces and is passed on to the renderPlot() function.
  output$plot <- renderPlot({
    title <- "this is a dummy graph"
    hist(rnorm(100), main = title)
    })

}

#create the shiny app from the UI and the server parts
shinyApp(ui = ui, server = server)


```

