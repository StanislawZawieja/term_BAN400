---
title: "Project in BAN400"
author: "Nina, Stan and Imran (Group 99 )"
date: "29 10 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#add docstring
#use map functions if possible

# Uploading packages that we are going to use (add more if necessary)
library(readxl)           #reading an excel file
library(tidyverse)        #for ggplot2, magrittr pipes, dplyr, etc
library(docstring)
library(priceR)# import the priceR package
library(shiny) # shiny package required to build the app
library(ggplot2)
library(gganimate)
```

```{ui shiny}

theme_set(theme_bw())

x <- currencies()

ui <- function(){
  fluidPage(
  #' User interface of the exchange rate converter
  #' 
  #' @description Makes a user choose which two currencies they want to
  #' compare within a chosen time period
  #' 
  #'  @usage .. 
  headerPanel("Silicon valley exchange rate converter"),
  
  sidebarLayout(
    sidebarPanel(selectInput(inputId = "currency1",
                             label = "What is the first currency?",
                             choices = x$description,
                             multiple = FALSE,
                             selectize = TRUE,
                             width = NULL,
                             size = NULL),
                 
                 selectInput(inputId = "currency2", 
                             label = "What is the second currency?",
                             choices = x$description,
                             multiple = FALSE,
                             selectize = TRUE,
                             width = NULL,
                             size = NULL),
                 
                 dateRangeInput(inputId = "dates",
                                label = "What time period do you want to look at?",
                                start = "2000-01-01",
                                end = NULL,
                                min = "2000-01-01",
                                max = Sys.Date(),
                                format = "dd-mm-yyyy",
                                startview = "decade",
                                weekstart = "1")),
                
                mainPanel(
                          textOutput(outputId = "text_rate"),
                          textOutput(outputId = "text_report"),
                          imageOutput("plot1"))) 
)
}

?ui #documentation of the function

```

```{server shiny}
#server instructions part of the app
server <- function(input, output) {
  
  #the code that generates each output goes inside the render() function
  #render functions create outputs
  
  output$text_rate <- renderText("your exchange rate is sth")
  
  output$text_report <- renderText(print("the user report is whatever"))
  #if the data is current or if the data is not current
#how volatile is the data?
#ask Big Hawk what we're supposed to test???
  

# Making the GIF by renderImage()
  
output$plot1 <- renderImage({
    # A temp file to save the output.
    # This file will be removed later by renderImage
    outfile <- tempfile(fileext='.gif')

    # making the animation
    
    df <- historical_exchange_rates(from = "EUR", to = "NOK", # from and to must be change to something like inputId1, the same goes for selected dates
                          start_date = "2018-01-01", end_date = "2020-11-21")
    
    GIF = ggplot(df, aes(x = as.Date(date), y = one_EUR_equivalent_to_x_NOK,
                          group = 1))+
           geom_line() +
           ylab("Price of one EUR in NOK") +
           xlab("Date") +
           labs(title = "Exchange rates between EUR and NOK") +
           theme_classic() +
           transition_reveal(date)

    anim_save("outfile.gif", animate(GIF, renderer=gifski_renderer(loop=FALSE)))

    # returning a list containing the filename
     list(src = "outfile.gif",
         contentType = 'image/gif',
          width = 400,
          height = 300,
          alt = "This is alternate text"
         )}, deleteFile = TRUE)

}

```

```{shiny App}
#create the shiny app from the UI and the server parts
shinyApp(ui, server)
```

